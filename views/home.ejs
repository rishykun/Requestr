<div style="text-align:center; font-weight: bold; font-size: 24px; color: #555">Home</div>

<!--  Search Only Implemented For Tags. Tags can be typed into the search bar and delimited by commas. -->
<input class="form-control" id="request-search" onKeyPress = "getSearchRequests(event)" type="text" name="keyword" data-toggle="tooltip" data-container="body" data-placement="bottom" title="Search by tags, request creator, etc." placeholder="Search for a request" style="width:50%; margin-left: 25%; margin-top: 20px">

<div id="requests-container" style="margin-top:20px; margin-bottom:20px">

	<% if (requests.length > 0) { %>
		<% requests.forEach(function(request) { %>

		<div id="request-box" style="background-color:whitesmoke; width:50%; margin-left:25%; margin-top: 10px; border-left: 7px solid <%= colors[request.status] %>; padding: 10px">
			<div id="request-header" data-toggle="tooltip" data-placement="right" title="Click to view details" onclick="viewRequest('<%= request._id %>')" style="background-color:<%= colors[request.status] %>; color: white; padding: 10px; cursor: pointer">
				<div id="request-status" style="display: inline-block; font-weight: bold; color: <%= colors[request.status] %>; background-color: whitesmoke; padding:2px">
					<!-- color depends on status OPEN - green, In-Progress - yellow, etc. -->
					<%= request.status %>
				</div>
				<div id="request-title-bar" style="display: inline-block; margin-left: 5px">
					Title: <%= request.title %>
				</div>
				<div id="request-expdate-bar" style="float:right; display: inline-block">
					Expires: <%= request.expirationDate %>
				</div>
				<div id="request-creator-bar" style="margin-top:5px">
					Requester: <%= request.creator.username %>
					<% if (request.status === "Completed" && userProfile.username === request.creator.username) { %>
						<div style="display:inline-block; float:right">
							<%= request.paid ? "Paid" : "Unpaid" %>
						</div>
					<% } %>
				</div>

			</div>
			<div id="request-body" style="padding:10px">
				<div id="request-desc-bar">
					Description: <%= request.description %>
				</div>
				<div id="request-rewards-bar" style="margin-top:5px">
					Rewards: 1 cookie
				</div>
			</div>
			<div id = "request-tags" style="font-size:16px">
				Tags:
				<% if (request.tags.length > 0) { %>
					<% request.tags.forEach(function(tag){ %>
						<%= tag%>
					<% }); %>
				<% } else { %>
					<i>n/a</i>
				<% } %>
			</div>
			<div id="request-footer" style="margin-top:5px">
				<% if (request.status === "Open") { %>
					<% if (userProfile.username !== request.creator.username) { %>
						<% console.log("DID"); %>
						<% var candidateNames = request.candidates === undefined ? [] : request.candidates.map(function (ele) { %>
						<% return ele.username; %>
						<% }); %>
						<% console.log("YOU"); %>
						<% var helperNames = request.helpers === undefined ? [] : request.helpers.map(function (ele) { %>
						<% return ele.username; %>
						<% }); %>
						<% console.log("GET"); %>
						<% if (candidateNames.indexOf(userProfile.username) === -1 && helperNames.indexOf(userProfile.username) === -1) { %>
							<button class="btn btn-primary" onclick="handleRequest('<%= request._id %>', 'accept')" style="border-radius:0px">Accept</button>
						<% } else if (request.candidates.indexOf(userProfile.username) !== -1 ) { %>
							<button class="btn btn-default" onclick="handleRequest('<%= request._id %>', 'cancel')" style="border-radius:0px">Drop Out</button>
						<% } else {%>
							Your help has been accepted.
						<% } %>
						<% console.log("HERE?"); %>
					<% } %>
				<% } else if (request.status === "In progress") { %>
					The request is currently in progress.
					<h4>Current Helpers:</h4>
					<ul class="list-group">
					 	<% request.helpers.forEach(function (helper) { %>
					 		<li class="list-group-item">
					 			<a href="/users/<%= helper.username %>"><%= helper.username %></a>
					 		</li>
					 	<% }); %>
					 	<% if (request.helpers.length > 0 && userProfile.username === request.creator.username) { %>
					 		<button class="btn btn-default" onclick="handleRequest('<%= request._id %>', 'complete')">Completed!</button>
					 	<% } %> 
					</ul>
				<% } else if (request.status === "Completed") { %>
					<% var participantNames = request.helpers.map(function (e) {return e.username;}); %>

					<% participantNames.push(request.creator.username); %>

					<% if (participantNames.indexOf(userProfile.username) > -1) { %>
						<button type="button" class="btn btn-default" data-toggle="modal" data-target="#review-modal" onclick="configureReviewModal('<%= request._id %>');">Submit a Review</button>
					<% } %>
					
					<% if (userProfile.username === request.creator.username) { %>
						<% if (request.paid) { %>
							<button class="btn btn-primary" onclick="handleRequest('<%= request._id %>', 'accept')">Paid</button>

						<% } else { %>
							<button class="btn btn-default" onclick="handleRequest('<%= request._id %>', 'cancel')">Pay</button>
						<% } %>
					<% } %>
				<% } %>
			</div>
		</div>
		<% }); %>
	<% } %>
</div>